{% extends 'admin_base.html' %}
{% block content %}
<div class="page-heading d-flex justify-content-between align-items-center">
  <h3>Courses</h3>
  <a href="{% url 'add_course' %}" class="btn btn-primary">
    <i class="bi bi-plus-circle"></i> Add Course
  </a>
</div>

<div class="page-content mt-4">
  <div class="row g-4" id="courseContainer">
    {% for course in courses %}
    <div class="col-12 course-card" data-bundle="{{ course.bundle.id }}">
      
      <div class="card shadow-sm border-0 rounded-4 overflow-hidden">
        <div class="row g-0 align-items-center">
          <!-- ðŸ–¼ï¸ Left Side: Image -->
          <div class="col-md-4">
            {% if course.thumbnail %}
            <img src="{{ course.thumbnail.url }}" class="img-fluid w-100 h-100" 
                 alt="{{ course.title }}" style="object-fit: cover; height: 200px;">
            {% else %}
            <img src="/static/assets/images/default-course.jpg" class="img-fluid w-100 h-100" 
                 alt="No Image" style="object-fit: cover; height: 200px;">
            {% endif %}
          </div>

          <!-- ðŸ“˜ Right Side: Course Info -->
          <div class="col-md-8">
            <div class="card-body d-flex flex-column h-100">
              <div>
                <h5 class="card-title mb-2">{{ course.title }}</h5>
                <p class="card-text text-muted small mb-3">{{ course.short_description|truncatechars:120 }}</p>

                <p class="mb-1">
                  <strong>Price:</strong>
                  {% if course.bundle and course.bundle.is_free %}
                    Free
                  {% else %}
                    â‚¹{{ course.bundle.get_discounted_price|floatformat:2 }}
                  {% endif %}
                </p>

                <p class="mb-1"><strong>Level:</strong> {{ course.level }}</p>
                <p class="mb-1"><strong>Language:</strong> {{ course.language }}</p>
              </div>

              <!-- Footer Buttons -->
              <div class="mt-auto d-flex justify-content-end gap-2">
                <a href="{% url 'edit_course' course.id %}" class="btn btn-sm btn-outline-warning">
                  <i class="bi bi-pencil-square"></i> Edit
                </a>
                <a href="{% url 'delete_course' course.id %}" class="btn btn-sm btn-outline-danger"
                   onclick="return confirm('Are you sure you want to delete this course?')">
                  <i class="bi bi-trash"></i> Delete
                </a>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    {% empty %}
    <div class="col-12 text-center">
      <div class="alert alert-info">No courses found. Add a new course to display here.</div>
    </div>
    {% endfor %}
  </div>
</div>

{% include 'notify.html' %}

<script>
// ðŸ” Filter Courses by Bundle
document.getElementById('bundleFilter')?.addEventListener('change', function() {
  const selectedBundle = this.value;
  const courseCards = document.querySelectorAll('.course-card');
  let visibleCount = 0;

  courseCards.forEach(card => {
    const bundleId = card.getAttribute('data-bundle');
    if (selectedBundle === 'all' || bundleId === selectedBundle) {
      card.style.display = 'block';
      visibleCount++;
    } else {
      card.style.display = 'none';
    }
  });

  const container = document.getElementById('courseContainer');
  if (visibleCount === 0) {
    if (!document.getElementById('noResultsMsg')) {
      const msg = document.createElement('div');
      msg.id = 'noResultsMsg';
      msg.className = 'col-12 text-center text-muted py-5';
      msg.innerHTML = '<i class="bi bi-journal-x display-5 d-block mb-3"></i><h5>No courses found for this bundle.</h5>';
      container.appendChild(msg);
    }
  } else {
    const msg = document.getElementById('noResultsMsg');
    if (msg) msg.remove();
  }
});
</script>
{% endblock %}

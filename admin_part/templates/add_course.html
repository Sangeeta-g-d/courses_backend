{% extends 'admin_base.html' %}
{% block content %}
<div class="page-heading d-flex justify-content-between align-items-center">
    <h3>Add Course</h3>
</div>

<div class="page-content mt-4">
    <div class="card">
        <div class="card-body">
          <form id="addCourseForm" method="POST" action="{% url 'add_course' %}" enctype="multipart/form-data" novalidate>
    {% csrf_token %}
    <div class="row g-3">
        <!-- Category -->
        <div class="col-md-6">
            <label for="category" class="form-label">Category</label>
            <select class="form-select" id="category" name="category" required>
                <option value="">Select Category</option>
                {% for cat in categories %}
                    <option value="{{ cat.id }}">{{ cat.name }}</option>
                {% endfor %}
            </select>
            <div class="invalid-feedback"></div>
        </div>

        <!-- Title -->
        <div class="col-md-6">
            <label for="title" class="form-label">Course Title</label>
            <input type="text" class="form-control" id="title" name="title" required>
            <div class="invalid-feedback"></div>
        </div>

        <!-- Thumbnail -->
        <div class="col-md-6">
            <label for="thumbnail" class="form-label">Thumbnail</label>
            <input type="file" class="form-control" id="thumbnail" name="thumbnail" accept="image/*">
            <div class="invalid-feedback"></div>
        </div>

        <!-- Preview Video -->
        <div class="col-md-6">
            <label for="preview_video" class="form-label">Preview Video</label>
            <input type="file" class="form-control" id="preview_video" name="preview_video" accept="video/*">
            <div class="invalid-feedback"></div>
        </div>

        <!-- Short Description (full width) -->
        <div class="col-12">
            <label for="short_description" class="form-label">Short Description</label>
            <textarea class="form-control" id="short_description" name="short_description" rows="3" required></textarea>
            <div class="invalid-feedback"></div>
        </div>

        <!-- Full Description (full width) -->
        <div class="col-12">
            <label for="full_description" class="form-label">Full Description</label>
            <textarea class="form-control" id="full_description" name="full_description" rows="4" required></textarea>
            <div class="invalid-feedback"></div>
        </div>

        <!-- Language -->
        <div class="col-md-6">
            <label for="language" class="form-label">Language</label>
            <input type="text" class="form-control" id="language" name="language" value="English" required>
            <div class="invalid-feedback"></div>
        </div>

        <!-- Level -->
        <div class="col-md-6">
            <label for="level" class="form-label">Level</label>
            <select class="form-select" id="level" name="level" required>
                <option value="Beginner">Beginner</option>
                <option value="Intermediate">Intermediate</option>
                <option value="Advanced">Advanced</option>
            </select>
            <div class="invalid-feedback"></div>
        </div>
        <!-- Course Includes (full width) -->
        <div class="col-12">
            <label for="course_includes" class="form-label">Course Includes (comma separated)</label>
            <input type="text" class="form-control" id="course_includes" name="course_includes">
            <div class="invalid-feedback"></div>
        </div>

        <!-- Requirements (full width) -->
        <div class="col-12">
            <label for="requirements" class="form-label">Requirements</label>
            <textarea class="form-control" id="requirements" name="requirements" rows="2"></textarea>
            <div class="invalid-feedback"></div>
        </div>

        <!-- Learning Outcomes (full width) -->
        <div class="col-12">
            <label for="learning_outcomes" class="form-label">Learning Outcomes</label>
            <textarea class="form-control" id="learning_outcomes" name="learning_outcomes" rows="2"></textarea>
            <div class="invalid-feedback"></div>
        </div>
    </div>

    <div class="mt-4">
        <button type="submit" class="btn btn-primary">Add Course</button>
    </div>
</form>

        </div>
    </div>
</div>

{% include 'notify.html' %}

<script>
document.getElementById('is_free').addEventListener('change', function() {
    const priceInput = document.getElementById('price');
    if (this.checked) {
        priceInput.value = 0;
        priceInput.setAttribute('readonly', true);
    } else {
        priceInput.removeAttribute('readonly');
    }
});

// Frontend Validation
document.getElementById('addCourseForm').addEventListener('submit', function(e) {
    let valid = true;
    const fields = ['category', 'title', 'short_description', 'full_description', 'language', 'level', 'price'];
    
    fields.forEach(function(id) {
        const input = document.getElementById(id);
        const feedback = input.nextElementSibling;
        if (!input.value || (input.type==='number' && input.value<0)) {
            feedback.innerText = 'This field is required';
            input.classList.add('is-invalid');
            valid = false;
        } else {
            feedback.innerText = '';
            input.classList.remove('is-invalid');
        }
    });

    if (!valid) {
        e.preventDefault();
    }
});
</script>
{% endblock %}
